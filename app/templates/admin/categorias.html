<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Administrar Categor√≠as</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
<div class="dashboard-container">

  <aside class="sidebar">
    <h2>¬°Hola,<br>{{ nombre or 'Usuario' }}!</h2>
    <p>Configuraci√≥n de categorias y dominios</p>
    <nav>
      <ul>
        <li><a href="{{ url_for('controlador.dashboard') }}"><img src="{{ url_for('static', filename='icons/home.png') }}" alt="Home"></a></li>
        <li><a href="{{ url_for('admin_controller.vista_metas') }}"><img src="{{ url_for('static', filename='icons/trophy.svg') }}" alt="Logros"></a></li>
        <li><a href="#" id="btnConfiguracion"><img src="{{ url_for('static', filename='icons/settings.svg') }}" alt="Configuraci√≥n"></a></li>
      </ul>
    </nav>
    
    <div class="alerta-coach-container" id="alerta-coach-sidebar">
        <div class="alerta-coach-titulo">
            <p>Alertas del Coach</p>
        </div>
        
        <div class="loading-box" id="coach-loading-state">
            <p>Cargando</p>
            <p style="font-size: 0.8em; color: var(--accent-light);">Esperando datos del coach...</p>
        </div>
        
        <div id="coach-alerts-list">
        </div>
    </div>
  </aside>

  <main class="content">

    <header class="main-header">
      <h1>ADMINISTRAR DOMINIOS Y CATEGOR√çAS</h1>
      <p class="intro-text">Organiza tus sitios web en categor√≠as personalizadas</p>
    </header>

    <div class="admin-grid-layout">

      <!-- FORMULARIO: Agregar nueva categor√≠a -->
      <div class="admin-box form-box">
        <h3>Agregar nueva categor√≠a</h3>
        <form action="{{ url_for('admin_controller.agregar_categoria') }}" method="POST" class="tile-form">
          <input type="text" name="nombre" placeholder="Nombre de la categor√≠a" required>
          <button type="submit">Agregar</button>
        </form>
      </div>

      <!-- FORMULARIO: Asociar dominio a categor√≠a -->
      <div class="admin-box form-box">
        <h3>Asociar dominio a categor√≠a</h3>
        <form action="{{ url_for('admin_controller.agregar_dominio') }}" method="POST" class="tile-form">
          <input type="text" name="dominio" placeholder="ej. youtube.com" required>
          <select name="categoria_id" required>
            <option value="">Selecciona una categor√≠a</option>
            {% for cat in categorias %}
              <option value="{{ cat.id }}">{{ cat.nombre }}</option>
            {% endfor %}
          </select>
          <button type="submit">Agregar</button>
        </form>
      </div>

      <!-- LISTA: Categor√≠as registradas -->
      <div class="admin-box list-box">
        <h3>Categor√≠as registradas</h3>
        <div class="scrollable-list-content">
          {% for cat in categorias %}
            <div class="list-item-row">
              <span><strong>{{ cat.id }}</strong> - {{ cat.nombre }}</span>
              
              <form action="{{ url_for('admin_controller.editar_categoria', id=cat.id) }}" method="POST">
                <input type="text" name="nuevo_nombre" value="{{ cat.nombre }}" required>
                <button type="submit">üíæ</button>
              </form>

              <form action="{{ url_for('admin_controller.eliminar_categoria', id=cat.id) }}" method="POST" style="display:inline;">
                <button type="submit" onclick="return confirm('¬øEliminar esta categor√≠a?')">üóëÔ∏è</button>
              </form>
            </div>
          {% endfor %}
        </div>
      </div>

      <!-- LISTA: Dominios registrados -->
      <div class="admin-box list-box">
        <h3>Dominios registrados</h3>
        <div class="scrollable-list-content">
          {% for d in dominios %}
            <div class="list-item-row">
              <span><strong>{{ d.dominio }}</strong> </span>
              
              <form action="{{ url_for('admin_controller.editar_dominio', id=d.id) }}" method="POST">
                <!-- Campo para editar el dominio -->
                <input type="text" name="nuevo_dominio" value="{{ d.dominio }}" required>
                
                <!-- Select para cambiar la categor√≠a -->
                <select name="nueva_categoria_id" required>
                  {% for cat in categorias %}
                    <option value="{{ cat.id }}" {% if cat.id == d.categoria_id %}selected{% endif %}>{{ cat.nombre }}</option>
                  {% endfor %}
                </select>
                
                <button type="submit">üíæ</button>
              </form>
              
              <form action="{{ url_for('admin_controller.eliminar_dominio', id=d.id) }}" method="POST" style="display:inline;">
                <button type="submit" onclick="return confirm('¬øEliminar este dominio?')">üóëÔ∏è</button>
              </form>
            </div>
          {% endfor %}
        </div>
      </div>

    </div>

  </main>

</div>

<!-- Men√∫ flotante de configuraci√≥n (opcional, si lo usas en otras vistas) -->
<div id="menuFlotanteConfig" class="config-dropdown hidden">
  <div class="tile-box menu-box">
      <h2 class="menu-title">Configuraci√≥n de la cuenta</h2>
      <button onclick="window.location.href='/admin/categorias'" class="menu-button">
          üóÇÔ∏è Administrar dominios y categor√≠as
      </button>
      <hr class="menu-separator">
      <div class="menu-section">
          <button onclick="window.location.href='/dashboard'" class="menu-button">
              üè† Volver al Dashboard
          </button>
      </div>
  </div>
</div>

<div id="toast-container" style="position:fixed;right:16px;bottom:16px;z-index:9999"></div>

<script src="{{ url_for('static', filename='js/coach_toast.js') }}"></script>
<script>
  if (!window.__coachPollingStarted) {
    window.__coachPollingStarted = true;
    checkCoachAlertas();
    window.__coachPolling = setInterval(checkCoachAlertas, 5 * 60 * 1000);
  }
  
  // L√≥gica del men√∫ desplegable de configuraci√≥n
  const btnConfig = document.getElementById('btnConfiguracion');
  const menuConfig = document.getElementById('menuFlotanteConfig');

  if (btnConfig && menuConfig) {
    btnConfig.addEventListener('click', (e) => {
      e.preventDefault(); 
      e.stopPropagation(); 
      menuConfig.classList.toggle('hidden');
    });

    document.addEventListener('click', (e) => {
      if (!menuConfig.contains(e.target) && !btnConfig.contains(e.target) && !menuConfig.classList.contains('hidden')) {
        menuConfig.classList.add('hidden');
      }
    });
  }
</script>
<script src="{{ url_for('static', filename='js/temas.js') }}"></script>
</body>
</html>