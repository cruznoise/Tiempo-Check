<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Configuraci√≥n de la Cuenta</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/config.css') }}">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</head>
<body>
  <div class="dashboard-container">
    
    <!-- Sidebar -->
    <aside class="sidebar">
      <h2>¬°Hola, {{ usuario.nombre }}!</h2>
      <p>Configuraci√≥n de la cuenta</p>
      <nav>
        <ul>
          <li><a href="{{ url_for('controlador.dashboard') }}"><img src="{{ url_for('static', filename='icons/home.png') }}" alt="Home"></a></li>
          <li><a href="{{ url_for('admin_controller.vista_metas') }}"><img src="{{ url_for('static', filename='icons/trophy.svg') }}" alt="Logros"></a></li>
          <li><a href="{{ url_for('admin_controller.vista_configuracion') }}"><img src="{{ url_for('static', filename='icons/settings.png') }}" alt="Configuraci√≥n"></a></li>
        </ul>
      </nav>
    </aside>

    <!-- Contenido principal -->
    <main class="content">
      <!-- Alertas -->
      <div id="alert-success" class="alert alert-success"></div>
      <div id="alert-error" class="alert alert-error"></div>

      <!-- Informaci√≥n Personal -->
      <div class="config-section">
        <h3>üìã Informaci√≥n Personal</h3>
        
        <div class="info-row">
          <div>
            <div class="info-label">Nombre de usuario</div>
            <div class="info-value" id="display-nombre">{{ usuario.nombre }}</div>
          </div>
          <button class="edit-btn" onclick="openEditModal('nombre')">‚úèÔ∏è Editar</button>
        </div>

        <div class="info-row">
          <div>
            <div class="info-label">Correo electr√≥nico</div>
            <div class="info-value">{{ usuario.correo }}</div>
          </div>
          <button class="edit-btn" onclick="openEditModal('correo')">‚úèÔ∏è Editar</button>
        </div>

        <div class="info-row">
          <div>
            <div class="info-label">Fecha de registro</div>
            <div class="info-value">{{ usuario.fecha_creacion.strftime('%d/%m/%Y') if usuario.fecha_creacion else 'No disponible' }}</div>
          </div>
        </div>

        <div class="info-row">
          <div>
            <div class="info-label">√öltimo acceso</div>
            <div class="info-value">{{ usuario.ultimo_acceso.strftime('%d/%m/%Y %H:%M') if usuario.ultimo_acceso else 'No disponible' }}</div>
          </div>
        </div>
      </div>

      <!-- Seguridad -->
      <div class="config-section">
        <h3>üîê Seguridad</h3>
        
        <div class="info-row">
          <div>
            <div class="info-label">Contrase√±a</div>
            <div class="info-value">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
          </div>
          <button class="edit-btn" onclick="openEditModal('password')">üîë Cambiar</button>
        </div>
      </div>

      <!-- Zona de Peligro -->
      <div class="danger-zone">
        <h4>‚ö†Ô∏è Zona de Peligro</h4>
        <p style="color: #888; margin-bottom: 15px;">Las acciones en esta secci√≥n son irreversibles</p>
        
        <button class="danger-btn" onclick="openResetModal()" style="margin-right: 10px;">
          üîÑ Resetear Cuenta
        </button>
        
        <button class="danger-btn" onclick="openDeleteModal()">
          üóëÔ∏è Eliminar Cuenta
        </button>
      </div>

      <!-- Bot√≥n de cerrar sesi√≥n -->
      <button id="logout-btn" class="btn btn-outline-danger mt-3" style="margin-top: 20px;">
        <i class="fas fa-sign-out-alt"></i> Cerrar sesi√≥n
      </button>
    </main>
  </div>

  <!-- Modal para editar nombre -->
  <div id="modal-nombre" class="modal-overlay">
    <div class="modal-content">
      <h3 class="modal-header">Cambiar nombre de usuario</h3>
      <form id="form-nombre" onsubmit="return submitFormNombre(event)">
        <div class="form-group">
          <label>Nuevo nombre</label>
          <input type="text" id="input-nombre" name="nuevo_nombre" required>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn-cancel" onclick="closeModal('nombre')">Cancelar</button>
          <button type="submit" class="btn-save">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal para editar correo -->
  <div id="modal-correo" class="modal-overlay">
    <div class="modal-content">
      <h3 class="modal-header">Cambiar correo electr√≥nico</h3>
      <form id="form-correo" onsubmit="return submitFormCorreo(event)">
        <div class="form-group">
          <label>Nuevo correo</label>
          <input type="email" id="input-correo" name="nuevo_correo" required>
        </div>
        <div class="form-group">
          <label>Confirma tu contrase√±a</label>
          <input type="password" id="input-password-correo" name="password" required>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn-cancel" onclick="closeModal('correo')">Cancelar</button>
          <button type="submit" class="btn-save">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal para cambiar contrase√±a -->
  <div id="modal-password" class="modal-overlay">
    <div class="modal-content">
      <h3 class="modal-header">Cambiar contrase√±a</h3>
      <form id="form-password" onsubmit="return submitFormPassword(event)">
        <div class="form-group">
          <label>Contrase√±a actual</label>
          <input type="password" id="input-password-actual" name="password_actual" required>
        </div>
        <div class="form-group">
          <label>Nueva contrase√±a</label>
          <input type="password" id="input-password-nueva" name="password_nueva" required minlength="6">
        </div>
        <div class="form-group">
          <label>Confirmar nueva contrase√±a</label>
          <input type="password" id="input-password-confirmar" name="password_confirmar" required minlength="6">
        </div>
        <div class="modal-actions">
          <button type="button" class="btn-cancel" onclick="closeModal('password')">Cancelar</button>
          <button type="submit" class="btn-save">Cambiar contrase√±a</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal para resetear cuenta -->
  <div id="modal-reset" class="modal-overlay">
    <div class="modal-content">
      <h3 class="modal-header" style="color: #e74c3c;">‚ö†Ô∏è Resetear Cuenta</h3>
      <p style="color: #888; margin-bottom: 20px;">
        Esta acci√≥n eliminar√° todos tus datos de uso, metas, logros y predicciones. Tu cuenta permanecer√° activa pero empezar√°s desde cero.
      </p>
      <form id="form-reset" onsubmit="return submitFormReset(event)">
        <div class="form-group">
          <label>Escribe "RESETEAR" para confirmar</label>
          <input type="text" id="input-confirm-reset" name="confirmacion" required>
        </div>
        <div class="form-group">
          <label>Confirma tu contrase√±a</label>
          <input type="password" id="input-password-reset" name="password" required>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn-cancel" onclick="closeModal('reset')">Cancelar</button>
          <button type="submit" class="danger-btn">Resetear Cuenta</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal para eliminar cuenta -->
  <div id="modal-delete" class="modal-overlay">
    <div class="modal-content">
      <h3 class="modal-header" style="color: #e74c3c;">‚ö†Ô∏è Eliminar Cuenta</h3>
      <p style="color: #888; margin-bottom: 20px;">
        Esta acci√≥n es <strong>PERMANENTE</strong> y no se puede deshacer. Se eliminar√° toda tu informaci√≥n y no podr√°s recuperar tu cuenta.
      </p>
      <form id="form-delete" onsubmit="return submitFormDelete(event)">
        <div class="form-group">
          <label>Escribe "ELIMINAR" para confirmar</label>
          <input type="text" id="input-confirm-delete" name="confirmacion" required>
        </div>
        <div class="form-group">
          <label>Confirma tu contrase√±a</label>
          <input type="password" id="input-password-delete" name="password" required>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn-cancel" onclick="closeModal('delete')">Cancelar</button>
          <button type="submit" class="danger-btn">Eliminar Cuenta Permanentemente</button>
        </div>
      </form>
    </div>
  </div>

  <script src="{{ url_for('static', filename='js/reset_back.js') }}"></script>
  <script src="{{ url_for('static', filename='js/temas.js') }}"></script>
  <script src="{{ url_for('static', filename='js/logout.js') }}"></script>
  <script src="{{ url_for('static', filename='js/config.js')}}"></script>
</body>
</html>