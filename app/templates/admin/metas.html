<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Metas y L√≠mites - ProcrastiGuard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
<div class="dashboard-container">

  <!-- Sidebar -->
  <aside class="sidebar">
    <h2>¬°Hola,<br>Angel!</h2>
    <p>Panel de Metas y Limites</p>
    <nav>
      <ul>
        <li><a href="{{ url_for('controlador.dashboard') }}"><img src="{{ url_for('static', filename='icons/home.png') }}" alt="Home"></a></li>
        <li><a href="{{ url_for('admin_controller.vista_metas') }}"><img src="{{ url_for('static', filename='icons/trophy.png') }}" alt="Logros"></a></li>
        <li><a href="{{ url_for('admin_controller.vista_configuracion') }}"><img src="{{ url_for('static', filename='icons/settings.svg') }}" alt="Configuraci√≥n"></a></li>

      </ul>
    </nav>
  </aside>

  <!-- Contenido -->
  <main class="content">
    
    <div class="seccion-metas">
    <div class="grupo-metales">
      

      <section class="seccion-logros">
        <div class="tile-box">
          <h2>üèÜ Logros desbloqueables</h2>
          <div class="logros-grid" id="contenedor-logros">
            <!-- Insignias cargadas din√°micamente -->
          </div>
        </div>
      </section>


      <!-- Agregar nueva meta -->

       <section class="tile-box">
      <h3>Agregar una nueva meta diaria</h3>
      <form class="tile-form" action="{{ url_for('admin_controller.agregar_meta') }}" method="POST">
        <select name="usuario_id" required>
          <option value="">Selecciona un usuario</option>
          {% for u in usuarios %}
          <option value="{{ u.id }}">{{ u.nombre }}</option>
          {% endfor %}
        </select>
        <select name="categoria_id" required>
          <option value="">Selecciona una categor√≠a</option>
          {% for c in categorias %}
          <option value="{{ c.id }}">{{ c.nombre }}</option>
          {% endfor %}
        </select>
        <input type="number" name="limite_minutos" placeholder="L√≠mite (min)" required min="1">
        <button type="submit">Aceptar</button>
      </form>
     </section>
     
     <!--Metas sugeridas-->

    <div class="tile-box seccion-sugerencias" id="sugerenciasMetas">
      <h2> Sugerencias de metas para hoy</h2>
       <div id="contenedor-sugerencias" data-usuario="{{ session['usuario_id'] }}"></div>
    </div>

     
      <div class="dashboard-form-grid">
      <!-- Metas existentes -->
      <div class="dashboard-form-grid">
      <section class="tile-box">
        <h3>Metas establecidas</h3>
        <table>
          <thead>
            <tr><th>ID</th><th>Usuario</th><th>Categor√≠a</th><th>L√≠mite</th><th>Acciones</th></tr>
          </thead>
          <tbody>
            {% for m in metas %}
            <tr>
              <td>{{ m.id }}</td>
              <td>{{ m.usuario.nombre }}</td>
              <td>{{ m.categoria.nombre }}</td>
              <td>
                <form action="{{ url_for('admin_controller.editar_meta', id=m.id) }}" method="POST">
                  <input type="number" name="limite_minutos" value="{{ m.limite_minutos }}" required min="1">
                  <button type="submit">üíæ</button>
                </form>
              </td>
              <td>
                <form action="{{ url_for('admin_controller.eliminar_meta', id=m.id) }}" method="POST">
                  <button type="submit" onclick="return confirm('¬øEliminar meta?')">üóëÔ∏è</button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </section>

      <!-- Estado de metas -->
      <section class="tile-box">
        <h3>Estado de metas hoy</h3>
        <table>
          <thead>
            <tr><th>Categor√≠a</th><th>Meta</th><th>Usado hoy</th><th>Estado</th></tr>
          </thead>
          <tbody>
            {% for meta in estado_metas %}
            <tr>
              <td>{{ meta.categoria }}</td>
              <td>{{ meta.meta }}</td>
              <td>{{ meta.usado }}</td>
              <td>
                {% if meta.cumplida %}
                <span class="estado-verde">Cumplida </span>
                {% else %}
                <span class="estado-naranja">Pendiente </span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </section>
      </div>
      </div>
     </div>

     <div class="seccion-limites">
        <div class="grupo-limites">
      <!-- Agregar nuevo l√≠mite -->
      <section class="tile-box">
        <h3>Agregar un nuevo l√≠mite diario</h3>
        <form class="tile-form" action="{{ url_for('admin_controller.agregar_limite') }}" method="POST">
          <select name="usuario_id" required>
            <option value="">Selecciona un usuario</option>
            {% for u in usuarios %}
            <option value="{{ u.id }}">{{ u.nombre }}</option>
            {% endfor %}
          </select>
          <select name="categoria_id" required>
            <option value="">Selecciona una categor√≠a</option>
            {% for c in categorias %}
            <option value="{{ c.id }}">{{ c.nombre }}</option>
            {% endfor %}
          </select>
          <input type="number" name="limite_minutos" placeholder="L√≠mite (min)" required min="1">
          <button type="submit">Aceptar</button>
        </form>
      </section>
    
      <!-- L√≠mites existentes -->
       <div class="dashboard-form-grid">
      <section class="tile-box">
        <h3>L√≠mites establecidos</h3>
        <table>
          <thead>
            <tr><th>ID</th><th>Usuario</th><th>Categor√≠a</th><th>L√≠mite</th><th>Acciones</th></tr>
          </thead>
          <tbody>
            {% for l in limites %}
            <tr>
              <td>{{ l.id }}</td>
              <td>{{ l.usuario.nombre }}</td>
              <td>{{ l.categoria.nombre }}</td>
              <td>
                <form action="{{ url_for('admin_controller.editar_limite', id=l.id) }}" method="POST">
                  <input type="number" name="limite_minutos" value="{{ l.limite_minutos }}" required min="1">
                  <button type="submit">üíæ</button>
                </form>
              </td>
              <td>
                <form action="{{ url_for('admin_controller.eliminar_limite', id=l.id) }}" method="POST">
                  <button type="submit" onclick="return confirm('¬øEliminar l√≠mite?')">üóëÔ∏è</button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </section>

      <!-- Estado de l√≠mites -->
      <section class="tile-box">
        <h3>Estado de l√≠mites hoy</h3>
        <table>
          <thead>
            <tr><th>Categor√≠a</th><th>L√≠mite</th><th>Usado hoy</th><th>Estado</th></tr>
          </thead>
          <tbody>
            {% for limite in estado_limites %}
            <tr>
              <td>{{ limite.categoria }}</td>
              <td>{{ limite.limite }}</td>
              <td>{{ limite.usado }}</td>
              <td>
                {% if limite.excedido %}
                <span class="estado-rojo">Excedido </span>
                {% else %}
                <span class="estado-verde">En rango </span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </section>
      </div>
    </div>
    </div>
  </main>
</div>


<script src="{{ url_for('static', filename='js/metas.js') }}"> </script>
<script src="{{ url_for('static', filename='js/temas.js') }}"></script>
</body>
</html>
