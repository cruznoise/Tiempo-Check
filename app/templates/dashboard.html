<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard - ProcrastiGuard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body
  data-uso-horario='{{ uso_horario|tojson }}'
  data-uso-diario='{{ uso_diario|tojson }}'
  data-categorias='{{ categorias|tojson }}'
  data-datos='{{ datos|tojson }}'>
  <div class="dashboard-container">

    <!-- Sidebar -->
    <aside class="sidebar">
      <h2>¬°Hola,<br>Angel!</h2>
      <p>Este es tu resumen personal</p>
      <nav>
      <ul>
        <li>
          <a href="{{ url_for('controlador.dashboard') }}">
            <img src="{{ url_for('static', filename='icons/home.svg') }}" alt="Home">
          </a>
        </li>
        <li>
          <a href="{{ url_for('admin_controller.vista_metas') }}">
            <img src="{{ url_for('static', filename='icons/trophy.svg') }}" alt="Logros">
          </a>
        </li>
        <li>
          <a href="{{ url_for('admin_controller.vista_configuracion') }}">
            <img src="{{ url_for('static', filename='icons/settings.svg') }}" alt="Configuraci√≥n">
          </a>
        </li>
      </ul>

      </nav>
    </aside>

    <!-- Contenido principal -->
    <main class="content">
      <header>
        <h1>DASHBOARD</h1>
        <p class="intro-text"> Este es un resumen personalizado de tu actividad digital.</p>
      </header>

      <section class="controls-bar">
        <div class="control-group">
          <label for="rango">Rango de tiempo:</label>
          <select id="rango">
            <option value="total">Total</option>
            <option value="hoy">Hoy</option>
            <option value="7dias">√öltimos 7 d√≠as</option>
            <option value="mes">√öltimo mes</option>
            <option value="entre">Entre fechas...</option>
          </select>
          <div id="fechas" style="display:none;">
            <input type="date" id="desde">
            <input type="date" id="hasta">
            <button id="filtrar">Aplicar</button>
          </div>
        </div>
        
        <div class="control-group">
          <div class="panel-temas">
            <h3>Elige tu estilo visual</h3>
            <select id="selector-tema">
              <option value="dark-minimal">üï∂Ô∏è Dark Minimal</option>
              <option value="claro-profesionald">üåû Claro Profesional</option>
              <option value="color-vivid">üåà Color Vivid</option>
              <option value="soft-pastel">üçÉ Soft Pastel</option>
              <option value="retro-terminal">üßÉ Retro Terminal</option>
            </select>
            <label class="toggle-container">
              <input type="checkbox" id="modoDiaNoche">
              <span class="slider"></span>
            </label>
            <label for="modoDiaNoche" class="toggle-label">üåô Modo noche</label>
          </div>
        </div>
      </section>

      <section class="summary-bar">
        <div class="summary-card">
          <h4>Tiempo total</h4>
          <p id="resumen-tiempo">...</p>
        </div>
        <div class="summary-card">
          <h4>D√≠a m√°s activo</h4>
          <p id="resumen-dia">...</p>
        </div>
        <div class="summary-card">
          <h4>Sitio m√°s visitado</h4>
          <p id="resumen-sitio">...</p>
        </div>
        <div class="summary-card">
          <h4>Categor√≠a dominante</h4>
          <p id="resumen-categoria">...</p>
        </div>
        <div class="summary-card">
          <h4>Promedio diario</h4>
          <p id="resumen-promedio">...</p>
        </div>
      </section>
      

      <div id="ml-predict-card" class="tile-box">
        <h3>Predicci√≥n de ma√±ana (por categor√≠a)</h3>
        <button id="btnPrediccionManana" class="btn btn-primary mt-3">
          Predicci√≥n de ma√±ana (por categor√≠a)
        </button>

        <ul id="ml-predict-list" class="list-group mt-2"></ul>

      </div>


      <section class="graphs">
        <div class="chart-box">
          <h3>Tiempo por sitio web</h3>
          <canvas id="grafica"></canvas>
        </div>

        <div class="chart-box">
          <h3>Distribuci√≥n por categor√≠a</h3>
          <canvas id="graficaPastel"></canvas>
        </div>

        <div class="chart-box">
          <h3>Distribuci√≥n de uso por hora</h3>
          <canvas id="graficaHorario"></canvas>
        </div>

        <div class="chart-box">
          <h3>Tiempo total en pantalla por d√≠a</h3>
          <canvas id="graficaLinea"></canvas>
        </div>
      </section>
    </main>
  </div>

<!-- Modal de alerta por l√≠mite excedido -->
<div id="alertaModal" class="modal-overlay hidden">
  <div class="modal-contenido">
    <h2>‚ÄúTiempoCheck‚Äù</h2>
    <p><span id="categoriaModal"></span> ¬øDeseas continuar?</p>
    <div class="botones">
      <button onclick="cerrarModal()">Aceptar y cerrar</button>
      <button onclick="ignorarAlerta()">Ignorar</button>
    </div>
  </div>
</div>

<div id="toast-container" style="position:fixed;right:16px;bottom:16px;z-index:9999"></div>
      <div id="toast-container"></div>
      <section>
        <h3>Alertas del Coach</h3>
        <div id="coach-alertas"></div>
      </section>


<script type="application/json" id="categorias-json">
  {{ categorias | tojson | safe }}
</script>
<script>

  window.categorias = {};
  try {
    const el = document.getElementById('categorias-json');
    if (el && el.textContent) {
      window.categorias = JSON.parse(el.textContent);
    }
  } catch (e) {
    console.error('Error parseando categorias JSON:', e);
  }
</script>
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
<script src="{{ url_for('static', filename='js/temas.js') }}"></script>
<script src="{{ url_for('static', filename='js/coach_toast.js')}}"></script>

</body>
</html>
