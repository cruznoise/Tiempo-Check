<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard - ProcrastiGuard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body
  data-uso-horario='{{ uso_horario|tojson }}'
  data-uso-diario='{{ uso_diario|tojson }}'
  data-categorias='{{ categorias|tojson }}'
  data-datos='{{ datos|tojson }}'>
  <div class="dashboard-container">

    <!-- Sidebar -->
    <aside class="sidebar">
      <h2>¬°Hola,<br>Angel!</h2>
      <p>Este es tu resumen personal</p>
      <nav>
      <ul>
        <li>
          <a href="{{ url_for('controlador.dashboard') }}">
            <img src="{{ url_for('static', filename='icons/home.svg') }}" alt="Home">
          </a>
        </li>
        <li>
          <a href="{{ url_for('admin_controller.vista_metas') }}">
            <img src="{{ url_for('static', filename='icons/trophy.svg') }}" alt="Logros">
          </a>
        </li>
        <li>
          <a href="{{ url_for('admin_controller.vista_configuracion') }}">
            <img src="{{ url_for('static', filename='icons/settings.svg') }}" alt="Configuraci√≥n">
          </a>
        </li>
      </ul>

      </nav>
    </aside>

    <!-- Contenido principal -->
    <main class="content">
      <header>
        <h1>DASHBOARD</h1>
        <p class="intro-text"> Este es un resumen personalizado de tu actividad digital.</p>
        <section class="panel-temas">
        <h3>Elige tu estilo visual</h3>
        <select id="selector-tema">
          <option value="dark-minimal">üï∂Ô∏è Dark Minimal</option>
          <option value="claro-profesional">üåû Claro Profesional</option>
          <option value="color-vivid">üåà Color Vivid</option>
          <option value="soft-pastel">üçÉ Soft Pastel</option>
          <option value="retro-terminal">üßÉ Retro Terminal</option>
        </select>
        <button onclick="aplicarTema()">Aplicar tema</button>

        <label>
          <input type="checkbox" id="modoDiaNoche"> üåô Modo noche
        </label>
      </section>

        <label for="rango">Rango de tiempo:</label>
        <select id="rango">
          <option value="total">Total</option>
          <option value="hoy">Hoy</option>
          <option value="7dias">√öltimos 7 d√≠as</option>
          <option value="mes">√öltimo mes</option>
          <option value="entre">Entre fechas...</option>
        </select>
        <div id="fechas" style="display:none;">
          <input type="date" id="desde">
          <input type="date" id="hasta">
          <button id="filtrar">Aplicar</button>
        </div>
      </header>

      <!-- M√≥dulo resumen -->
      <section class="summary-bar">
        <div class="summary-card">
          <h4>Tiempo total</h4>
          <p id="resumen-tiempo">...</p>
        </div>
        <div class="summary-card">
          <h4>D√≠a m√°s activo</h4>
          <p id="resumen-dia">...</p>
        </div>
        <div class="summary-card">
          <h4>Sitio m√°s visitado</h4>
          <p id="resumen-sitio">...</p>
        </div>
        <div class="summary-card">
          <h4>Categor√≠a dominante</h4>
          <p id="resumen-categoria">...</p>
        </div>
        <div class="summary-card">
          <h4>Promedio diario</h4>
          <p id="resumen-promedio">...</p>
        </div>
      </section>


      <!-- Gr√°ficas -->
      <section class="graphs">
        <div class="chart-box">
          <h3>Tiempo por sitio web</h3>
          <canvas id="grafica"></canvas>
             <p class="chart-description">Estos son los sitios donde pasaste m√°s tiempo en el periodo seleccionado. 
            El an√°lisis te puede ayudar a detectar h√°bitos repetitivos o p√°ginas que demandan mucha atenci√≥n. </p>
        </div>

        <div class="chart-box">
          <h3>Distribuci√≥n por categor√≠a</h3>
          <canvas id="graficaPastel"></canvas>
            <p class="chart-description">Esta gr√°fica agrupa los sitios por categor√≠as generales. As√≠ puedes visualizar el equilibrio 
            (o desequilibrio) entre actividades de ocio, redes, productividad, educaci√≥n, etc. </p>
        </div>

        <div class="chart-box">
          <h3>Distribuci√≥n de uso por hora</h3>
          {% if rango == 'total' %}
            <p class="text-xs opacity-70 mt-2">
              {% if mostrar_nota_hora %}
                Mostrando distribuci√≥n por hora desde {{ cutover }} (vista limpia).
                <a class="underline" href="?rango=total&todo_historico=1">Ver todo el hist√≥rico</a>
              {% else %}
                Mostrando todo el hist√≥rico (incluye 00:00). 
                <a class="underline" href="?rango=total&todo_historico=0">Ver vista limpia</a>
              {% endif %}
            </p>
          {% endif %}

          <canvas id="graficaHorario"></canvas>
            <p class="chart-description">
          Aqu√≠ se representa el tiempo total que pasas frente a la pantalla seg√∫n la hora del d√≠a. Este gr√°fico te ayuda a visualizar en qu√© momentos eres m√°s propenso a usar el dispositivo, lo que puede ser √∫til para planificar tus h√°bitos.
        </p>
        </div>


        <div class="chart-box">
          <h3>Tiempo total en pantalla por d√≠a</h3>
          <canvas id="graficaLinea"></canvas>
            <p class="chart-description"> Aqu√≠ se muestra tu tiempo total frente a la pantalla por d√≠a. 
            Identifica si tus h√°bitos est√°n subiendo o bajando. Ideal para reconocer d√≠as con mayor distracci√≥n o foco. </p>
        </div>
        <div class="tile-box" style="display:flex;gap:12px;align-items:center;">
        <div>
          <div style="font-size:14px;opacity:.7;">Features diarias</div>
          <div id="fd-count" style="font-size:22px;font-weight:600;">‚Äî</div>
        </div>
        <div>
          <div style="font-size:14px;opacity:.7;">Features horarias</div>
          <div id="fh-count" style="font-size:22px;font-weight:600;">‚Äî</div>
        </div>
        <div style="margin-left:auto;">
          <span id="qa-badge" class="badge">‚Äî</span>
        </div>
      </div>

      </section>


    </main>
  </div>

 <!-- ALERTAS EMERGENTES LUGAR PROVISIONAL-->

<!-- Modal de alerta por l√≠mite excedido -->
<div id="alertaModal" class="modal-overlay hidden">
  <div class="modal-contenido">
    <h2>‚ÄúTiempoCheck‚Äù</h2>
    <p><span id="categoriaModal"></span> ¬øDeseas continuar?</p>
    <div class="botones">
      <button onclick="cerrarModal()">Aceptar y cerrar</button>
      <button onclick="ignorarAlerta()">Ignorar</button>
    </div>
  </div>
</div>

<div id="toast-container" style="position:fixed;right:16px;bottom:16px;z-index:9999"></div>


<script type="application/json" id="categorias-json">
  {{ categorias | tojson | safe }}
</script>
<script>

  window.categorias = {};
  try {
    const el = document.getElementById('categorias-json');
    if (el && el.textContent) {
      window.categorias = JSON.parse(el.textContent);
    }
  } catch (e) {
    console.error('Error parseando categorias JSON:', e);
  }
</script>
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
<script src="{{ url_for('static', filename='js/temas.js') }}"></script>

</body>
</html>
